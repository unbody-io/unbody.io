import {Unbody} from "@unbody-io/ts-client";
import MuxVideo from '@mux/mux-video-react';
import {useWindowScroll} from "@uidotdev/usehooks";

import NewHero from "../containers/NewHero/NewHero";
import {useSSG} from "nextra/ssg";
import {mapRange} from "../lib/utils";

export const getStaticProps = async () => {
    const u = new Unbody({
        apiKey: process.env.UNBODY_API_KEY,
        projectId: process.env.UNBODY_PROJECT_ID
    })

    const {data: {payload: introVideo}} = await u.get.videoFile
        .where({
            remoteId: "1X03E8Y1zbPml1hx09Ee96JcfwrpLq9HI"
        })
        .exec()
        .catch(e => {
            console.error(e)
            return {
                data: {
                    payload: []
                }
            }
        })

    return {
        props: {
            ssg: {
                introVideo: introVideo[0] || null
            }
        },
        revalidate: 10
    }
}


export const Video = () => {
    const {introVideo} = useSSG();
    const [{y}] = useWindowScroll();

    return (
        <div style={{
            width: "100%",
            overflow: "hidden",
            borderRadius: "20px 20px 0 0",
        }}>
            <MuxVideo
                style={{height: '100%', maxWidth: '100%'}}
                playbackId={introVideo?.playbackId}
                metadata={{
                    video_id: introVideo?.assetId,
                    video_title: "Unbody intro demo",
                }}
                streamType="on-demand"
                controls
            />
        </div>
    )

}


export const PageContent = ({children}) => {
    return (
        <div style={{
            background: "#080808",
            marginTop: "100vh",
            minHeight: "100vh",
            borderRadius: "50px 50px 0 0",
            display: "flex",
            flexDirection: "column",
            alignItems: "center",
            padding: "50px",
        }}>
            {children}
        </div>
    )
}

<div className={"home-content"}>
    <div className="content-container">
        <NewHero/>
        <div className="text-paraghraph_gray text-base text-center h-20 px-4 lg:hidden"></div>
        <PageContent>
            <section style={{
                width: "100%",
                display: "flex",
                flexDirection: "column",
                alignItems: "center",
                gap: "20px",
            }}>
                <div className={"text-5xl font-semibold"}>
                    Watch how Unbody works!
                </div>
                <span className="text-paraghraph_gray text-base leading-6 hidden md:block">
                    Choose your AI, connect your data, and build with ease.
                </span>
                <Video/>
            </section>
        </PageContent>
    </div>
</div>
